<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Noobly JS</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* Ensure CSS variables are defined */
        :root {
            --primary-color: #efb829;
            --primary-light: #f4c74f;
            --primary-dark: #d4a01e;
            --secondary-color: #dc004e;
            --surface-color: #ffffff;
            --surface-variant: #fef9ed;
            --background-color: #fffcf5;
            --error-color: #d32f2f;
            --success-color: #388e3c;
            --text-primary: #212121;
            --text-secondary: #757575;
            --border-color: #f0e6d2;
            --shadow-1: 0 1px 3px rgba(239,184,41,0.12), 0 1px 2px rgba(239,184,41,0.24);
            --shadow-2: 0 3px 6px rgba(239,184,41,0.16), 0 3px 6px rgba(239,184,41,0.23);
            --shadow-3: 0 10px 20px rgba(239,184,41,0.19), 0 6px 6px rgba(239,184,41,0.23);
        }

        /* Reset and base styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background-color: var(--background-color);
            color: var(--text-primary);
            line-height: 1.6;
        }
        .dashboard-container {
            min-height: 100vh;
            background: var(--background-color);
        }

        .dashboard-header {
            background: var(--surface-color);
            padding: 16px 24px;
            box-shadow: var(--shadow-1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .dashboard-logo {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary-color);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .user-name {
            font-weight: 500;
            color: var(--text-primary);
        }

        .btn-logout {
            padding: 8px 16px;
            background: var(--secondary-color);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s ease;
        }

        .btn-logout:hover {
            background: #b8003d;
        }

        .dashboard-content {
            padding: 32px;
        }

        .welcome-section {
            background: var(--surface-color);
            padding: 32px;
            border-radius: 12px;
            box-shadow: var(--shadow-1);
            margin-bottom: 32px;
            text-align: center;
        }

        .welcome-title {
            font-size: 32px;
            font-weight: bold;
            color: var(--text-primary);
            margin-bottom: 16px;
        }

        .welcome-subtitle {
            color: var(--text-secondary);
            font-size: 18px;
            margin-bottom: 24px;
        }

        .service-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
            margin-top: 32px;
            width: 100%;
            max-width: 100%;
        }

        .service-card {
            background: var(--surface-color);
            padding: 24px;
            border-radius: 12px;
            box-shadow: var(--shadow-1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            position: relative;
            min-height: 150px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .service-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-2);
        }

        .service-name {
            font-size: 20px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .service-description {
            color: var(--text-secondary);
            margin-bottom: 16px;
        }

        .service-status {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
        }

        .service-card-content {
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .service-card-info {
            flex-grow: 1;
        }

        .service-card-actions {
            margin-top: auto;
        }

        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--text-secondary);
        }

        .status-indicator.running {
            background: var(--success-color);
        }

        .status-indicator.stopped {
            background: var(--error-color);
        }

        .btn-service {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            font-size: 14px;
            margin-top: 12px;
            transition: background-color 0.3s ease;
        }

        .btn-service:hover {
            background: var(--primary-dark);
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <header class="dashboard-header">
            <div class="dashboard-logo">Noobly JS Dashboard</div>
            <div class="user-info">
                <span class="user-name" id="user-name">Loading...</span>
                <button class="btn-logout" id="logout-btn">Logout</button>
            </div>
        </header>

        <main class="dashboard-content">
            <section class="welcome-section">
                <h1 class="welcome-title">Welcome to your Dashboard!</h1>
                <p class="welcome-subtitle">You are successfully authenticated and can now access all Noobly JS services.</p>
            </section>

            <div class="service-grid" id="service-grid">
                <!-- Services will be loaded here -->
            </div>
        </main>
    </div>

    <script>
        const services = [
            {
                name: 'Authentication',
                description: 'User authentication and session management',
                path: '/services/authservice/',
                endpoint: 'authservice'
            },
            {
                name: 'AI Service',
                description: 'Artificial intelligence and machine learning capabilities',
                path: '/services/aiservice/',
                endpoint: 'aiservice'
            },
            {
                name: 'Cache Management',
                description: 'High-performance data caching with analytics',
                path: '/services/caching/',
                endpoint: 'caching'
            },
            {
                name: 'Data Serve',
                description: 'Persistent key-value data storage',
                path: '/services/dataserve/',
                endpoint: 'dataserve'
            },
            {
                name: 'File Management',
                description: 'File upload, download, and management',
                path: '/services/filing/',
                endpoint: 'filing'
            },
            {
                name: 'Logging',
                description: 'Application logging and monitoring',
                path: '/services/logging/',
                endpoint: 'logging'
            },
            {
                name: 'Measuring',
                description: 'Metrics collection and aggregation',
                path: '/services/measuring/',
                endpoint: 'measuring'
            },
            {
                name: 'Notifications',
                description: 'Pub/sub notification system',
                path: '/services/notifying/',
                endpoint: 'notifying'
            },
            {
                name: 'Queue Management',
                description: 'Task queuing and background job processing',
                path: '/services/queueing/',
                endpoint: 'queueing'
            },
            {
                name: 'Scheduling',
                description: 'Cron-like task scheduling',
                path: '/services/scheduling/',
                endpoint: 'scheduling'
            },
            {
                name: 'Search',
                description: 'Full-text search and indexing',
                path: '/services/searching/',
                endpoint: 'searching'
            },
            {
                name: 'Background Tasks',
                description: 'Background task execution',
                path: '/services/working/',
                endpoint: 'working'
            },
            {
                name: 'Workflows',
                description: 'Multi-step workflow orchestration',
                path: '/services/workflow/',
                endpoint: 'workflow'
            }
        ];

        // Check authentication
        function checkAuth() {
            const authToken = localStorage.getItem('authToken');
            const currentUser = localStorage.getItem('currentUser');

            if (!authToken || !currentUser) {
                window.location.href = '/login.html';
                return null;
            }

            try {
                return JSON.parse(currentUser);
            } catch {
                localStorage.removeItem('authToken');
                localStorage.removeItem('currentUser');
                window.location.href = '/login.html';
                return null;
            }
        }

        // Validate token with server
        async function validateToken() {
            const authToken = localStorage.getItem('authToken');

            try {
                const response = await fetch('/services/authservice/api/validate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ token: authToken })
                });

                const result = await response.json();

                if (!result.success) {
                    localStorage.removeItem('authToken');
                    localStorage.removeItem('currentUser');
                    window.location.href = '/login.html';
                }
            } catch (error) {
                console.error('Token validation error:', error);
                // Continue with local validation
            }
        }

        // Load user information
        function loadUserInfo() {
            const user = checkAuth();
            if (user) {
                document.getElementById('user-name').textContent = user.username;
            }
        }

        // Load services
        async function loadServices() {
            const serviceGrid = document.getElementById('service-grid');

            for (const service of services) {
                const serviceCard = document.createElement('div');
                serviceCard.className = 'service-card';

                const serviceCardContent = document.createElement('div');
                serviceCardContent.className = 'service-card-content';

                const serviceCardInfo = document.createElement('div');
                serviceCardInfo.className = 'service-card-info';

                const serviceName = document.createElement('div');
                serviceName.className = 'service-name';
                serviceName.textContent = service.name;

                const serviceDescription = document.createElement('div');
                serviceDescription.className = 'service-description';
                serviceDescription.textContent = service.description;

                const serviceCardActions = document.createElement('div');
                serviceCardActions.className = 'service-card-actions';

                const serviceStatus = document.createElement('div');
                serviceStatus.className = 'service-status';

                const statusIndicator = document.createElement('div');
                statusIndicator.className = 'status-indicator';
                statusIndicator.id = `status-${service.endpoint}`;

                const statusText = document.createElement('span');
                statusText.textContent = 'Checking...';

                const serviceButton = document.createElement('a');
                serviceButton.className = 'btn-service';
                serviceButton.href = service.path;
                serviceButton.textContent = 'Access Service';

                // Build structure
                serviceStatus.appendChild(statusIndicator);
                serviceStatus.appendChild(statusText);

                serviceCardInfo.appendChild(serviceName);
                serviceCardInfo.appendChild(serviceDescription);

                serviceCardActions.appendChild(serviceStatus);
                serviceCardActions.appendChild(serviceButton);

                serviceCardContent.appendChild(serviceCardInfo);
                serviceCardContent.appendChild(serviceCardActions);

                serviceCard.appendChild(serviceCardContent);
                serviceGrid.appendChild(serviceCard);

                // Check service status
                try {
                    const response = await fetch(`/services/${service.endpoint}/api/status`);
                    if (response.ok) {
                        statusIndicator.classList.add('running');
                        statusText.textContent = 'Running';
                    } else {
                        statusIndicator.classList.add('stopped');
                        statusText.textContent = 'Stopped';
                    }
                } catch (error) {
                    statusIndicator.classList.add('stopped');
                    statusText.textContent = 'Error';
                }
            }
        }

        // Logout functionality
        async function logout() {
            const authToken = localStorage.getItem('authToken');

            try {
                await fetch('/services/authservice/api/logout', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ token: authToken })
                });
            } catch (error) {
                console.error('Logout error:', error);
            }

            localStorage.removeItem('authToken');
            localStorage.removeItem('currentUser');
            window.location.href = '/login.html';
        }

        // Event listeners
        document.getElementById('logout-btn').addEventListener('click', logout);

        // Initialize
        validateToken();
        loadUserInfo();
        loadServices();
    </script>
</body>
</html>